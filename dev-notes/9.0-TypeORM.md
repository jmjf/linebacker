# Build adapters to connect to the database with TypeORM

For reasons, I need to support TypeORM, so build repo adapters that use it.

## Plan

My Prisma adapters probably serve as a pattern for my TypeORM adapters. TypeORM's syntax will be a bit different, but should be similar.

Basic plan:

-  Set up MSSQL docker compose (for reasons)
-  Install TypeORM
-  Define data-source and entities for TypeORM
   -  Use Prisma as a reference
-  Write a Q&D test program to confirm TypeORM can connect and write data
-  Write `TypeormBackupRequestRepo`

## Setup notes

MS SQL

-  Added `docker-compose/dev-ms.yml`
-  Added env variables to `env/dev.env`
   -  MSSQL_SA_PASSWORD="pick_your_password"
   -  ACCEPT_EULA="Y"
-  Tried to use volumes, but had issues, so commented out
-  Got SQL Server running and used Adminer to create a database
-  Tried to setup a login and user, but couldn't grant permissions, so will use sa for now
-  Added env variables to use for TypeORM
   -  SQLSERVER_USER=sa
   -  SQLSERVER_PASSWORD=pick_your_password
   -  SQLSERVER_DB=linebacker
   -  SQLSERVER_SCHEMA=lb

TypeORM

-  Referring to an install in a clean directory to find what I really need
-  `npm install typeorm mssql reflect-metadata`
-  Add to `tsconfig.json`
   -  "emitDecoratorMetadata": true
   -  "experimentalDecorators": true
   -  "strictPropertyInitialization": false
-  Create `/src/typeorm`, `/src/typeorm/entity`, `/src/typeorm/migration`
-  Create `/src/typeorm/dataSource.ts`
-  Create `.../entity/BackupRequest.entity.ts`
-  `npx typeorm migration:create src/typeorm/migration/backupRequest`
-  Build `.../migration/BackupRequest.sql` to create the table because I don't want TypeORM controlling the database structure
   -  Schema doesn't seem to work as expected, so just use dbo
-  Write test program `src/toTest.ts`

Errors encountered

-  TypeScript wouldn't compile entity
   -  Add to `tsconfig.json` -> `"strictPropertyInitialization": false`
-  Self-signed certificate error
   -  Add option to `toDataSource` -> `encrypted: false`
   -  TypeORM won't pass through `trustServerCertificate: true`
-  Can't connected because user is ''
   -  Load environment before importing `toDataSource`
-  Columns aren't nullable (apparently NOT NULL is the default)
   -  Add explicit NULL to SQL
   -  Alter table to make columns nullable

It works.

**COMMIT: CHORE: Get TypeORM functioning with MSSQL so I can begin developing with it**

## Next steps

-  Add url and port to env (`toDataSource`)
-  Write `TypeormBackupRequestRepo`
-  Write `Backup` entity
-  Write `TypeormBackupRepo`
