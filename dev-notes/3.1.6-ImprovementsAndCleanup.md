# Improvements and cleanup

## Dates
[x] Make date getters consistent everywhere.
Added `dateOrUndefinedAsDate()` to get a date or undefined.

[x] Places where I convert a date to a string may get an invalid date string. What to do about that?
Added checks to `dateOrUndefinedAsDate()` to ensure string values are valid dates.

[x] add tests for `dateOrUndefinedAsDate()`

## Type values
I'd like to move away from hardcoded string values for type values, but I see a lot of "avoid enums" arguments.

I need to export an object from the types so I can use `typeObject.typeValue` and avoid the risk of changing values.

I think I can export the object in each of my types, just need to come up with a naming convention.

[x] Replace hardcoded constants with references to "enum" objects.

**COMMIT - 3.1.6.1 - REFACTOR: date checking; avoid hardcoded strings for type values**

## Ensure no backward status moves
A request starts in received status.
It moves to a checked status (allowed or not allowed). It cannot move back to received.
It moves to sent status (if allowed). I cannot move back to received or checked.
It moves to replied status (succeeded or failed). It cannot move to any other status.

To move to a following status, the request must be in the appropriate previous status.

Question to consider: Should I allow it to move forward if it is in the wrong previous status?
For example, if I get a reply for a request that says it isn't sent yet, should I assume I had a failure updating the status after sending?

Thought: If the first step of startup recovery is processing any messages from the backup interface, then probably.

[x] When checking for allowed (already had this)
  * If the request is already checked, sent, or replied, skip it (as ok, but log info).
  * The request must be received (or it has a bad status).
[x] When sending to the backup interface (added check for replied)
  * If the request is already sent or replied, skip it (as ok, but log info).
  * The request must be allowed.
[x] When receiving a reply from the backup interface
  * If the request is already replied, skip it (as ok, but log info).
  * The request may be any other status.

**COMMIT: 3.1.6.2 - ADD: checks to prevent backward status moves**

## Error responses
[] Add error types and expand `Response` left options to include them for all domain entities/aggregates.

I really want to return an error object with a message and an optional object containing data about the error.